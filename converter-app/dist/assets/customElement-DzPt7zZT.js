import{L as I,c as d,s as h,x as g,i as E,D as S,a as B}from"./index-Jm6Lqj3l.js";import{u as O,I as D}from"./interactive-AX423Ykt.js";import{c as x}from"./observers-Bm1uD5MH.js";import{d as C,c as y}from"./sortableComponent-DtdO-UwB.js";import{e as G,a as A}from"./dom-BkrmyNGC.js";import{g as M}from"./guid-LcV_DAvu.js";import{u as P}from"./useSetFocus-DzYiweXQ.js";import{u as H}from"./useCancelable-hYby1SFN.js";import{d as T}from"./debounce-D0Dr7phT.js";import"./index-CvLbqiOd.js";import"./component-BTo6IVYW.js";import"./logger-LcGvEg7n.js";function u(c){return c.tagName==="CALCITE-BLOCK"}const p={container:"container",groupContainer:"group-container",scrim:"scrim",assistiveText:"assistive-text"},m="calcite-block-group",b="calcite-block",w=E`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}.container{position:relative}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`;function $(c){c.forEach(e=>{e.setPosition=c.indexOf(e)+1,e.setSize=c.length})}const f=class f extends I{constructor(){super(),this.dragSelector=b,this.handleSelector="calcite-sort-handle",this.mutationObserver=x("mutation",()=>{this.updateBlockItemsDebounced()}),this.blockAndGroups=[],this.cancelable=H()(this),this.focusSetter=P()(this),this.updateBlockItemsDebounced=T(this.updateBlockItems,S.nextTick),this.sortHandleMenuItems=[],this.disabled=!1,this.dragEnabled=!1,this.loading=!1,this.scale="m",this.sortDisabled=!1,this.calciteBlockGroupDragEnd=d({cancelable:!1}),this.calciteBlockGroupDragStart=d({cancelable:!1}),this.calciteBlockGroupOrderChange=d({cancelable:!1}),this.calciteBlockGroupMoveHalt=d({cancelable:!1}),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteBlockSortHandleBeforeOpen",this.updateBlockItemsDebounced),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove),this.listen("calciteSortHandleAdd",this.handleSortAdd)}async setFocus(e){return this.focusSetter(()=>this.el,e)}emitOrderChangeEvent(e){this.calciteBlockGroupOrderChange.emit(e)}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.updateBlockItemsDebounced(),this.setUpSorting(),this.setParentBlockGroup(),this.cancelable.add(this.updateBlockItemsDebounced)}willUpdate(e){(e.has("group")||e.has("canPull")&&this.hasUpdated||e.has("canPut")&&this.hasUpdated||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1)||e.has("sortDisabled")&&(this.hasUpdated||this.sortDisabled!==!1))&&this.updateBlockItemsDebounced(),e.has("scale")&&this.hasUpdated&&this.updateBlockAndGroupScale()}updated(){O(this)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),C(this)}updateBlockItems(){this.updateGroupItems();const{dragEnabled:e,el:a,sortDisabled:t,sortHandleMenuItems:o}=this,s=Array.from(this.el.querySelectorAll(b)),l=a,n=Array.from(l.children).filter(u);s.forEach(r=>{r.closest(m)===a&&(r.moveToItems=o.filter(i=>this.validateSortMenuItem({type:"move",fromEl:l,toEl:i.element,dragEl:r,newIndex:0,oldIndex:n.indexOf(r)})),r.addToItems=this.sortHandleMenuItems.filter(i=>this.validateSortMenuItem({type:"add",fromEl:l,toEl:i.element,dragEl:r,newIndex:0,oldIndex:n.indexOf(r)})),r.dragHandle=e,r.sortDisabled=t)}),this.setUpSorting()}updateGroupItems(){const{el:e,group:a}=this,t=G(e),o=a?Array.from(t.querySelectorAll(`${m}[group="${a}"]`)).filter(s=>!s.disabled&&s.dragEnabled):[];this.sortHandleMenuItems=o.map(s=>({element:s,label:s.label??s.id,id:M()}))}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentBlockGroupEl||e.defaultPrevented||(e.preventDefault(),this.handleReorder(e))}handleSortAdd(e){this.parentBlockGroupEl||e.defaultPrevented||(e.preventDefault(),this.handleAdd(e))}handleSortMove(e){this.parentBlockGroupEl||e.defaultPrevented||(e.preventDefault(),this.handleMove(e))}connectObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){this.mutationObserver?.disconnect()}setUpSorting(){const{dragEnabled:e}=this;e&&y(this)}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteBlockGroupDragEnd.emit(e)}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteBlockGroupDragStart.emit(e)}onDragSort(e){this.setParentBlockGroup(),this.updateBlockItemsDebounced(),this.calciteBlockGroupOrderChange.emit(e)}setParentBlockGroup(){this.parentBlockGroupEl=this.el.parentElement?.closest(m)}handleDefaultSlotChange(e){const a=[];this.blockAndGroups=A(e).filter(t=>(t.matches(b)&&a.push(t),t.matches(b)||t.matches(m))),$(a),this.updateBlockAndGroupScale()}updateBlockAndGroupScale(){this.blockAndGroups.forEach(e=>{e.scale=this.scale})}validateSortMenuItem({fromEl:e,toEl:a,dragEl:t,newIndex:o,oldIndex:s,type:l}){if(!e||!a||a===e||t.contains(a))return!1;const n=e.canPull?.({toEl:a,fromEl:e,dragEl:t,newIndex:o,oldIndex:s})??!0,r=a.canPut?.({toEl:a,fromEl:e,dragEl:t,newIndex:o,oldIndex:s})??!0;return(l==="add"?n==="clone":n===!0)&&r}handleAdd(e){const{addTo:a}=e.detail,t=e.target,o=t?.parentElement,s=a.element,n=Array.from(o.children).filter(u).indexOf(t),r=0;if(!this.validateSortMenuItem({type:"add",fromEl:o,toEl:s,dragEl:t,newIndex:r,oldIndex:n}))return;t.sortHandleOpen=!1,this.disconnectObserver();const i=t.cloneNode();s.prepend(i),this.updateBlockItemsDebounced(),this.connectObserver();const k={dragEl:t,fromEl:o,toEl:s,newIndex:r,oldIndex:n};this.calciteBlockGroupOrderChange.emit(k),s.emitOrderChangeEvent(k)}handleMove(e){const{moveTo:a}=e.detail,t=e.target,o=t?.parentElement,s=a.element,n=Array.from(o.children).filter(u).indexOf(t),r=0;if(!this.validateSortMenuItem({type:"move",fromEl:o,toEl:s,dragEl:t,newIndex:r,oldIndex:n}))return;t.sortHandleOpen=!1,this.disconnectObserver(),s.prepend(t),this.updateBlockItemsDebounced(),this.connectObserver();const i={dragEl:t,fromEl:o,toEl:s,newIndex:r,oldIndex:n};this.calciteBlockGroupOrderChange.emit(i),s.emitOrderChangeEvent(i)}handleReorder(e){const{reorder:a}=e.detail,t=e.target,o=t?.parentElement;if(!o)return;t.sortHandleOpen=!1;const s=Array.from(o.children).filter(u),l=s.length-1,n=s.indexOf(t);let r=n;switch(a){case"top":r=0;break;case"bottom":r=l;break;case"up":r=n===0?0:n-1;break;case"down":r=n===l?l:n+1;break}this.disconnectObserver();const i=a==="up"||a==="top"?s[r]:s[r].nextSibling;o.insertBefore(t,i),this.updateBlockItemsDebounced(),this.connectObserver(),this.calciteBlockGroupOrderChange.emit({dragEl:t,fromEl:o,toEl:o,newIndex:r,oldIndex:n})}render(){const{loading:e,label:a}=this;return D({disabled:this.disabled,children:g`<div class=${h(p.container)}>${this.dragEnabled?g`<span aria-live=assertive class=${h(p.assistiveText)}>${this.assistiveText}</span>`:null}${e?g`<calcite-scrim class=${h(p.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${a||""} class=${h(p.groupContainer)} role=group><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></div>`})}};f.properties={assistiveText:[16,{},{state:!0}],sortHandleMenuItems:[16,{},{state:!0}],canPull:[0,{},{attribute:!1}],canPut:[0,{},{attribute:!1}],disabled:[7,{},{reflect:!0,type:Boolean}],dragEnabled:[7,{},{reflect:!0,type:Boolean}],group:[3,{},{reflect:!0}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],sortDisabled:[7,{},{reflect:!0,type:Boolean}]},f.styles=w;let v=f;B("calcite-block-group",v);export{v as BlockGroup};
