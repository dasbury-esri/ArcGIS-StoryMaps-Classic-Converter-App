import{g as A,h as M,t as b,T as j}from"./index-Jm6Lqj3l.js";import{p as C,v as p,s as v,M as x,m as D}from"./directive-helpers-DJc9qV4_.js";const w=(r,a,c)=>{const h=new Map;for(let e=a;e<=c;e++)h.set(r[e],e);return h},I=A(class extends M{constructor(r){if(super(r),r.type!==b.CHILD)throw Error("repeat() can only be used in text expressions")}dt(r,a,c){let h;c===void 0?c=a:a!==void 0&&(h=a);const e=[],i=[];let l=0;for(const u of r)e[l]=h?h(u,l):l,i[l]=c(u,l),l++;return{values:i,keys:e}}render(r,a,c){return this.dt(r,a,c).values}update(r,[a,c,h]){const e=C(r),{values:i,keys:l}=this.dt(a,c,h);if(!Array.isArray(e))return this.ut=l,i;const u=this.ut??=[],f=[];let y,g,t=0,o=e.length-1,s=0,n=i.length-1;for(;t<=o&&s<=n;)if(e[t]===null)t++;else if(e[o]===null)o--;else if(u[t]===l[s])f[s]=p(e[t],i[s]),t++,s++;else if(u[o]===l[n])f[n]=p(e[o],i[n]),o--,n--;else if(u[t]===l[n])f[n]=p(e[t],i[n]),v(r,f[n+1],e[t]),t++,n--;else if(u[o]===l[s])f[s]=p(e[o],i[s]),v(r,e[t],e[o]),o--,s++;else if(y===void 0&&(y=w(l,s,n),g=w(u,t,o)),y.has(u[t]))if(y.has(u[o])){const d=g.get(l[s]),m=d!==void 0?e[d]:null;if(m===null){const k=v(r,e[t]);p(k,i[s]),f[s]=k}else f[s]=p(m,i[s]),v(r,e[t],m),e[d]=null;s++}else x(e[o]),o--;else x(e[t]),t++;for(;s<=n;){const d=v(r,f[n+1]);p(d,i[s]),f[s++]=d}for(;t<=o;){const d=e[t++];d!==null&&x(d)}return this.ut=l,D(r,f),j}});export{I as c};
