---
title: Notebook vs App Flow – Map Series Conversion
format: html
---

This document compares the ArcGIS Notebook (Python) flow with the converter app (TypeScript/JavaScript) flow for Classic Map Series → ArcGIS StoryMaps conversion.

::: {layout-ncol=2}
::: column
## ArcGIS Notebooks (Python)

```{mermaid}
flowchart TB
  A1([Start]) --> A2[Setup and authenticate]
  A2 --> A3[Input classic item id]
  A3 --> A4[Fetch classic item data]
  A4 --> A5[Extract theme title entries]
  A5 --> A6[Loop entries]
  A6 --> A6a[Classify media]
  A6a --> A6a1{Media type}
  A6a1 -->|webmap| A6w[Parse webmap JSON and extent]
  A6a1 -->|image| A6i[Resolve image URL]
  A6a1 -->|video| A6v[Resolve video/embed URL]
  A6a1 -->|embed| A6e1[Resolve webpage URL]
  A6w --> A6b[Parse side panel HTML]
  A6i --> A6b
  A6v --> A6b
  A6e1 --> A6b
  A6b --> A6c[Generate thumbnails]
  A6c --> A6c1{Thumb source}
  A6c1 -->|map| A6c2[Render extent to image]
  A6c1 -->|image| A6c3[Fetch image and downscale]
  A6c1 -->|video| A6c4[Use default thumbnail]
  A6c1 -->|embed| A6c5[Fallback default thumbnail]
  A6c2 --> A6d
  A6c3 --> A6d
  A6c4 --> A6d
  A6c5 --> A6d
  A6d[Build StoryMap nodes]
  A6d --> A6e[Suppress cover page]
  A6e --> A6f[Create StoryMap item]
  A6f --> A7[Publish story]
  A7 --> A8[Collect published items]
  A8 --> A9[Create Collection]
  A9 --> A10[Optional create folder]
  A10 --> A11[Move items to folder]
  A11 --> A12([Done])
```
:::

::: column
## Converter App (TS/JS) – Updated Flow

```{mermaid}
%%{init: {"theme": "default"}}%%
flowchart TB
  start([Start]) --> load[Load classic JSON]
  load --> detect[Detect template]
  detect --> convert[Convert series]
  convert --> theme[Apply theme]
  theme --> loop[Loop entries]
  loop --> classify[Classify media]
  classify --> choice{Media type}
  choice --> wm[Create webmap]
  choice --> img[Create image]
  choice --> vid[Create video embed]
  choice --> emb[Create embed]
  wm --> enrich[Enrich extent]
  enrich --> narrative[Build narrative]
  img --> narrative
  vid --> narrative
  emb --> narrative
  narrative --> thumbs[Generate thumbnails]
  thumbs --> src{Thumb source}
  src --> mapthumb[Map render]
  src --> imgthumb[Image downscale]
  src --> defthumb[Default]
  src --> fbthumb[Fallback]
  mapthumb --> collect[Collect story JSONs]
  imgthumb --> collect
  defthumb --> collect
  fbthumb --> collect
  collect --> persist[Persist local outputs]
  persist --> links[Show builder links]
  links --> agsm[Create collection]
  agsm --> detect2[Detect theme and layout]
  detect2 --> thumbset[Set collection thumbnail]
  thumbset --> finish[Finish publishing]
  finish --> done([Done])
```
:::
:::

---

## Key Differences

- Orchestration: Python uses widgets and ArcGIS Python API; App uses TS modules, `ConverterFactory`, and `BaseConverter` lifecycle.
- Theme: Python extracts and stores theme; App resolves base (`summit`/`obsidian`) and overrides from `values.settings.theme.colors`, applied to `story-theme` resource.
- Output: Python publishes items and builds a live Collection; App writes `draft.json`, all `entry-<n>.json`, and `collection-draft.json` locally under repo `tmp-converted` and surfaces builder links.
- Enrichment: Both enrich maps, but App embeds extent/viewpoint on resources and nodes during build for quick inspection.
- UX: Python flow is button-driven in Notebook UI; App runs in browser UI with test tasks for validation.

---

## Notes
- Collection Creation: App posts a full AGSM Collection JSON (`collection-cover`, `collection-nav`, `collection-ui`, root `collection`, and `story-theme` resource). Items array includes `{ itemId, title, thumbnailUrl }`.
- Local Save Path: Netlify function now resolves path from `import.meta.url` to ensure files save under repository `tmp-converted`.
- Publish UX: After “Create Collection,” the UI shows a “Click to Finish Publishing →” button with the spelled-out edit URL.

- Mermaid labels are simplified for Mermaid v11 compatibility.
- This page focuses on Map Series; see QUARTO_LOGIC_DIAGRAM.qmd for full converter flows.
