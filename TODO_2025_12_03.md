# TO DO

## Known Issues / Gaps

- Converter coverage: Only Map Journal and Swipe are active under the unified path. Map Tour, Map Series, Cascade, Shortlist, Crowdsource, Basic need either refactor implementations or legacy adaptation hooks.
- HTML parsing: Ensure consistent handling of inline HTML blocks, embeds, linking, and sanitization across templates; confirm adapters map HTML → text/rich-text nodes reliably.
- Media mapping: Legacy’s image fetch and resource mapping semantics must be ported to the new resource model to prevent broken dependents and dangling references.
- Diagnostics: Backend validation via Netlify function is disabled by default; local-only validation can miss CORS-restricted failures.
- Minor lint: A few unused vars remain (e.g., setIsMobile), but runtime is stable.

## Next Steps

- Template coverage expansion:
  - Implement refactor converters for Map Tour, Map Series, Cascade, Shortlist, Crowdsource, Basic in src/converters/.
  - For each: define mappings for theme, sections, text/HTML, media, actions, and resources.
- Media/resource pipeline standardization:
  - Create shared helper(s) to fetch, de-duplicate, and attach media as StoryMaps resources with stable IDs and dependents.
  - Migrate legacy media mapping rules to the new shared pipeline to avoid inconsistency.
- HTML content normalization:
  - Introduce a single HTML-to-StoryMaps content transformer with safe link/image handling, embed detection, and calcite/ArcGIS patterns.
- Validation and assertions:
  - Expand assertions.ts to cover newly supported templates; add checks for resource consistency (dependents, node references).
- Diagnostics toggle:
  - Re-enable backend diagnostics behind a flag; ensure Netlify dev function stubs work locally; surface endpoint category summaries in a lightweight, non-duplicative format if helpful.
- Tests and scripts:
  - Add per-template unit tests (fixtures under test_data) and quick scripts to validate detection + conversion + warnings in isolation.
  - Include a focused test for the b324ffc… webmap warnings scenario to validate consolidation output.
- UX polish:
  - Clarify messages around HTTPS updating and Map Viewer Classic links; add deep links to ArcGIS Assistant and item settings with resolved org base.

## Operational Notes

- netlify dev starts Vite and functions together; it’s not just npm -w converter-app run dev. Functions under /.netlify/functions will work in dev then proxy in production.
- Ensure arcgis-client.ts provides all required methods (createDraftStory, getItemDetails, findDraftResourceName, removeResource, addResource, updateItemKeywords) and matches auth expectations.

### If you want, I can:

- Scan src/legacy-converter and produce a per-template gap analysis against the refactor converters.
- Re-enable diagnostics behind a small flag and verify the function endpoints locally.
- Add the first new refactor converter (e.g., Map Tour) with a minimal end-to-end path and a test fixture.